<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CGPA Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center p-5">

  <div class="bg-white p-10 rounded-2xl shadow-lg w-full max-w-3xl">
    <h1 class="text-2xl md:text-3xl font-semibold text-gray-800 text-center mb-8">CGPA Calculator</h1>

    <!-- Step 1: Lateral Entry -->
    <div id="step1" class="space-y-6">
      <label class="block text-base font-medium text-gray-700">Are you a Lateral Entry student?</label>
      <div class="flex gap-4">
        <button onclick="setLateral(true)" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-800 text-white rounded-full">Yes</button>
        <button onclick="setLateral(false)" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full">No</button>
      </div>
    </div>

    <!-- Step 2: Backlog -->
    <div id="step2" class="space-y-6 hidden">
      <label class="block text-base font-medium text-gray-700">Do you have any backlogs?</label>
      <div class="flex gap-4">
        <button onclick="setBacklog(true)" class="px-6 py-3 bg-indigo-600 hover:bg-indigo-800 text-white rounded-full">Yes</button>
        <button onclick="setBacklog(false)" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-full">No</button>
      </div>
    </div>

    <!-- Step 2.1: Specify backlog semesters -->
    <div id="step2a" class="space-y-6 hidden">
      <label class="block text-base font-medium text-gray-700">Enter backlog semesters (comma-separated, e.g., 3,5)</label>
      <input type="text" id="backlogSems" class="block w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Enter semesters">
      <button onclick="validateBacklogs()" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-800 text-white py-3 rounded-lg">Next</button>
    </div>

    <!-- Step 3: Semesters completed -->
    <div id="step3" class="space-y-6 hidden">
      <label for="completedSems" class="block text-base font-medium text-gray-700">Till which semester have you completed?</label>
      <input type="number" id="completedSems" min="1" max="8" class="block w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Enter number (1–8)">
      <button onclick="goToMarks()" class="mt-4 w-full bg-indigo-600 hover:bg-indigo-800 text-white py-3 rounded-lg">Next</button>
    </div>

    <!-- Step 4: GPA input -->
    <div id="step4" class="space-y-6 hidden">
      <div id="marksContainer" class="grid md:grid-cols-2 gap-x-8 gap-y-6"></div>
      <button onclick="calculateCGPA()" class="mt-4 w-full bg-green-600 hover:bg-green-800 text-white py-3 rounded-lg">Calculate CGPA</button>
    </div>

    <!-- Result -->
    <div id="result" class="mt-8 text-center text-lg font-medium text-gray-800 hidden"></div>
  </div>

  <script>
    const credits = [20, 20, 20, 23, 20, 20, 20, 20];
    let isLateralEntry = false;
    let hasBacklog = false;
    let backlogSemesters = [];
    let completedSemesters = 0;

    function setLateral(value) {
      isLateralEntry = value;
      document.getElementById("step1").classList.add("hidden");
      document.getElementById("step2").classList.remove("hidden");
    }

    function setBacklog(value) {
      hasBacklog = value;
      document.getElementById("step2").classList.add("hidden");
      if (value) {
        document.getElementById("step2a").classList.remove("hidden");
      } else {
        document.getElementById("step3").classList.remove("hidden");
      }
    }

    function validateBacklogs() {
      let input = document.getElementById("backlogSems").value.trim();
      if (!input) {
        alert("Please enter backlog semesters.");
        return;
      }
      backlogSemesters = input.split(",").map(s => parseInt(s.trim())).filter(n => !isNaN(n));

      // Check for invalid backlog entries
      if (backlogSemesters.some(s => s < 1 || s > 8)) {
        alert("Invalid semester number in backlog list.");
        return;
      }
      if (isLateralEntry && backlogSemesters.some(s => s === 1 || s === 2)) {
        alert("Lateral entry students cannot have backlog in semester 1 or 2.");
        return;
      }

      document.getElementById("step2a").classList.add("hidden");
      document.getElementById("step3").classList.remove("hidden");
    }

    function goToMarks() {
      completedSemesters = parseInt(document.getElementById("completedSems").value) || 0;
      if (completedSemesters < 1 || completedSemesters > 8) {
        alert("Please enter a valid number of completed semesters (1–8).");
        return;
      }
      if (isLateralEntry && completedSemesters < 3) {
        alert("Lateral entry students start from semester 3.");
        return;
      }

      document.getElementById("step3").classList.add("hidden");
      document.getElementById("step4").classList.remove("hidden");

      const container = document.getElementById("marksContainer");
      container.innerHTML = "";

      for (let i = 1; i <= completedSemesters; i++) {
        if (isLateralEntry && (i === 1 || i === 2)) continue;
        if (backlogSemesters.includes(i)) continue;

        const inputDiv = document.createElement("div");
        inputDiv.className = "relative";
        inputDiv.innerHTML = `
          <input type="number" id="gpa${i}" step="0.01" min="0" max="10"
            class="block w-full h-12 px-5 py-2 bg-white text-gray-900 text-base shadow-xs border border-gray-300 rounded-full placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            placeholder="Semester ${i} GPA">
        `;
        container.appendChild(inputDiv);
      }
    }

    function calculateCGPA() {
      let totalCredits = 0;
      let totalWeightedGPA = 0;

      for (let i = 1; i <= completedSemesters; i++) {
        if (isLateralEntry && (i === 1 || i === 2)) continue;
        if (backlogSemesters.includes(i)) continue;

        let gpaValue = parseFloat(document.getElementById(`gpa${i}`)?.value);
        if (isNaN(gpaValue)) {
          alert(`Please enter GPA for Semester ${i}.`);
          return;
        }

        totalCredits += credits[i - 1];
        totalWeightedGPA += credits[i - 1] * gpaValue;
      }

      let cgpa = totalWeightedGPA / totalCredits;
      const cgpaPercentage = (cgpa - 0.5) * 10;

      document.getElementById("result").classList.remove("hidden");
      document.getElementById("result").innerHTML =
        `Your CGPA is: ${cgpa.toFixed(2)}<br>Your CGPA Percentage is: ${cgpaPercentage.toFixed(2)}%`;
    }
  </script>

</body>
</html>
